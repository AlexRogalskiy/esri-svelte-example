import{bE as e,cn as t,ck as s,v as r}from"./vendor.d0a39f0f.js";import{a as i}from"./Container.90659a9c.js";import{I as n}from"./Utils.ea926aef.js";import{a as o,b as a,m as l}from"./WGLContainer.e726cb8a.js";class h extends i{constructor(t,s,r,i,n,o=i,a=n){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new e(t),this.x=s,this.y=r,this.width=i,this.height=n,this.rangeX=o,this.rangeY=a}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e,r){const i=r/(e.resolution*e.pixelRatio),n=this.transforms.tileMat3,[o,a]=e.toScreenNoRotation([0,0],[this.x,this.y]),l=this.width/this.rangeX*i,h=this.height/this.rangeY*i;t(n,l,0,0,0,h,0,o,a,1),s(this.transforms.dvs,e.displayViewMat3,n)}}const c=(e,t)=>e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col;class d extends o{constructor(e){super(),this._tileInfoView=e}get requiresDedicatedFBO(){return!1}renderChildren(e){this.sortChildren(c),this.setStencilReference(),super.renderChildren(e)}createRenderParams(e){const{state:t}=e,s=super.createRenderParams(e);return s.requiredLevel=this._tileInfoView.getClosestInfoForScale(t.scale).level,s.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(t.scale),s}prepareRenderPasses(e){const t=super.prepareRenderPasses(e);return t.push(e.registerRenderPass({name:"stencil",brushes:[a],drawPhase:n.DEBUG|n.MAP|n.HIGHLIGHT,target:()=>this.getStencilTarget()})),r("esri-tiles-debug")&&t.push(e.registerRenderPass({name:"tileInfo",brushes:[l],drawPhase:n.DEBUG,target:()=>this.children})),t}getStencilTarget(){return this.children}updateTransforms(e){for(const t of this.children){const s=this._tileInfoView.getTileResolution(t.key);t.setTransform(e,s)}}setStencilReference(){let e=1;for(const t of this.children)t.stencilRef=e++}}export{d as o,h as r};
