var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,h=(t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i;import{m as a,bf as l,bg as c,w as o,bh as f,bi as d,bj as u,bk as _,bl as p,bm as g,bn as m,v,P as b,q as y,bo as R,Y as O}from"./vendor.d0a39f0f.js";const T=-1;class w{constructor(e=200){this.duration=e,this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this._effect="",this._effects=[],this._scale=0}get effect(){return this._effect}set effect(e){if(e=e||"",this._effect===e)return;this._effect=e;const t=function(e){if(!e)return[];if("string"==typeof e){const t=c(e);return t.error?t.error:[{scale:T,effects:t.effects}]}const t=[];for(const s of e){if(!isFinite(s.scale)||s.scale<=0)return new o("effect:invalid-scale","scale must be finite and greater than 0",{stop:s});const e=c(s.value);if(e.error)return e.error;t.push({scale:s.scale,effects:e.effects})}t.sort(((e,t)=>t.effects.length-e.effects.length));for(let s=0;s<t.length-1;s++){if(!q(t[s].effects,t[s+1].effects))return new o("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:t[s].effects,b:t[s+1].effects});C(t[s].effects,t[s+1].effects)}return t.sort(((e,t)=>t.scale-e.scale)),t}(e);Array.isArray(t)?this._transitionTo(t):(this._transitionTo([]),a.getLogger("esri.views.layers.effects.EffectList").warn("Invalid Effect",{effect:e,error:t}))}get hasEffects(){return this.transitioning||!!this._effects.length}get effects(){return this._effects}get scale(){return this._scale}get transitioning(){return null!==this._to}transitionStep(e,t){this._applyTimeTransition(e),this._updateForScale(t)}_transitionTo(e){this.scale>0&&function(e,t,s){var i,r,n,h;return null==(i=e[0])||!i.effects||null==(r=t[0])||!r.effects||!(((null==(n=e[0])?void 0:n.scale)===T||(null==(h=t[0])?void 0:h.scale)===T)&&(e.length>1||t.length>1)&&s<=0)&&q(e[0].effects,t[0].effects)}(this._current,e,this.scale)?(this._final=e,this._to=l(e),function(e,t,s){var i,r;const n=e.length>t.length?e:t,h=e.length>t.length?t:e,a=h[h.length-1],l=null!=(i=null==a?void 0:a.scale)?i:s,c=null!=(r=null==a?void 0:a.effects)?r:[];for(let o=h.length;o<n.length;o++)h.push({scale:l,effects:[...c]});for(let o=0;o<n.length;o++)h[o].scale=h[o].scale===T?s:h[o].scale,n[o].scale=n[o].scale===T?s:n[o].scale,C(h[o].effects,n[o].effects)}(this._current,this._to,this.scale),this._from=l(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=e),this._effects=this._current[0]?l(this._current[0].effects):[]}_applyTimeTransition(e){if(!this._to)return;this._time+=e;const t=Math.min(1,this._time/this.duration);for(let s=0;s<this._current.length;s++){const e=this._current[s],i=this._from[s],r=this._to[s];e.scale=I(i.scale,r.scale,t);for(let s=0;s<e.effects.length;s++){const n=e.effects[s],h=i.effects[s],a=r.effects[s];n.interpolate(h,a,t)}}1===t&&(this._current=this._final,this._effects=this._current[0]?l(this._current[0].effects):[],this._from=this._to=this._final=null)}_updateForScale(e){if(0===this._current.length)return;this._scale=e;const t=this._current,s=this._current.length-1;let i,r,n=1;if(1===t.length||e>=t[0].scale)r=i=t[0].effects;else if(e<=t[s].scale)r=i=t[s].effects;else for(let h=0;h<s;h++){const s=t[h],a=t[h+1];if(s.scale>=e&&a.scale<=e){n=(e-s.scale)/(a.scale-s.scale),i=s.effects,r=a.effects;break}}for(let h=0;h<this._effects.length;h++)this._effects[h].interpolate(i[h],r[h],n)}}function S(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new m(e.type,0);case"saturate":case"brightness":case"contrast":return new m(e.type,1);case"opacity":return new g(1);case"hue-rotate":return new p(0);case"blur":return new _(0);case"drop-shadow":return new d(0,0,0,[...u("transparent")]);case"bloom":return new f(0,0,0)}}function q(e,t){const s=e.length>t.length?e:t;return(e.length>t.length?t:e).every(((e,t)=>e.type===s[t].type))}function C(e,t){const s=e.length>t.length?e:t,i=e.length>t.length?t:e;for(let r=i.length;r<s.length;r++)i.push(S(s[r]))}function I(e,t,s){return e+(t-e)*s}const L=1/v("mapview-transitions-duration");class P extends b{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){if(this._stage===e)return;const t=this._stage;this._stage=e,e?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):t.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return y(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=R(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=R(),this.requestRender()),this._fadeOutResolver.promise}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var e;null==(e=this.parent)||e.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this.onDetach(),this.emit("detach")}updateTransitionProperties(e,t){if(this.fadeTransitionEnabled){const t=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===t)this.computedVisible=this.visible;else{const i=e*L;this.computedOpacity=s>t?Math.max(t,s-i):Math.min(t,s+i),this.computedVisible=this.computedOpacity>0;const r=t===this.computedOpacity;this.inFadeTransition=!r,r||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}const A=v("mapview-transitions-duration");class E extends P{constructor(){super(...arguments),this._childrenSet=new Set,this._needsSort=!1,this.children=[],this._effectList=null}get blendMode(){return this._blendMode}set blendMode(e){this._blendMode=e,this.requestRender()}get clips(){return this._clips}set clips(e){this._clips=e,this.children.forEach((t=>t.clips=e))}get computedEffects(){var e,t;return null!=(e=null==(t=this._effectList)?void 0:t.effects)?e:null}get effect(){var e,t;return null!=(e=null==(t=this._effectList)?void 0:t.effect)?e:""}set effect(e){(this._effectList||e)&&(this._effectList||(this._effectList=new w(A)),this._effectList.effect=e,this.requestRender())}updateTransitionProperties(e,t){super.updateTransitionProperties(e,t),this._effectList&&(this._effectList.transitionStep(e,t),this._effectList.transitioning&&this.requestRender())}doRender(e){const t=this.createRenderParams(e);this.renderChildren(t)}addChild(e){return this.addChildAt(e,this.children.length)}addChildAt(e,t=this.children.length){if(!e)return e;if(this.contains(e))return e;this._needsSort=!0;const s=e.parent;return s&&s!==this&&s.removeChild(e),t>=this.children.length?this.children.push(e):this.children.splice(t,0,e),this._childrenSet.add(e),e.parent=this,e.stage=this.stage,this!==this.stage&&(e.clips=this.clips),this.requestRender(),e}contains(e){return this._childrenSet.has(e)}removeAllChildren(){this._childrenSet.clear(),this._needsSort=!0;for(const e of this.children)this!==this.stage&&(e.clips=null),e.stage=null,e.parent=null;this.children.length=0}removeChild(e){return this.contains(e)?this.removeChildAt(this.children.indexOf(e)):e}removeChildAt(e){if(e<0||e>=this.children.length)return null;this._needsSort=!0;const t=this.children.splice(e,1)[0];return this._childrenSet.delete(t),this!==this.stage&&(t.clips=null),t.stage=null,t.parent=null,t}sortChildren(e){this._needsSort&&(this.children.sort(e),this._needsSort=!1)}_createTransforms(){return{dvs:O()}}onAttach(){super.onAttach();const e=this.stage;for(const t of this.children)t.stage=e}onDetach(){super.onDetach();for(const e of this.children)e.stage=null}renderChildren(e){for(const t of this.children)t.beforeRender(e);for(const t of this.children)t.processRender(e);for(const t of this.children)t.afterRender(e)}createRenderParams(e){return a=((e,t)=>{for(var s in t||(t={}))r.call(t,s)&&h(e,s,t[s]);if(i)for(var s of i(t))n.call(t,s)&&h(e,s,t[s]);return e})({},e),l={blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:e.globalOpacity*this.computedOpacity,inFadeTransition:this.inFadeTransition},t(a,s(l));var a,l}}export{P as a,E as n,w as u};
