import{ec as ir,e9 as sr,el as lr,a9 as h,aa as A,ab as cr,cs as ur,ae as M,O as fr,em as G,en as pr,eo as yr,ep as U,eq as W,er as gr,es as mr,et as w,eu as hr,ev as C,ew as Ar,aj as Tr,r as z,ex as $r,ey as dr,ez as S,m as Er,eA as x,eB as vr,eC as Fr,eD as Mr,eE as k,eF as D,eG as H,eH as wr,e8 as xr,q as y,eI as P,eJ as J,eK as Pr,eL as Rr,eM as br}from"./vendor.f5642644.js";import{I as K,v as Nr,P as Br,e as Q,a as X}from"./quat.137c3e0c.js";import{e as T,a as E,b as Lr,c as _r,f as $,o as Z}from"./vec33.fa3e38ea.js";import{T as p,i as f}from"./BufferView.49ab0c27.js";function v(r=Cr){return[r[0],r[1],r[2],r[3]]}function ce(r,e,t=v()){return ir(F(t),r),t[3]=e,t}function ue(r,e,t=v()){return K(R,F(r),Y(r)),K(rr,F(e),Y(e)),Nr(R,rr,R),jr(t,lr(Br(F(t),R)))}function F(r){return r}function Y(r){return sr(r[3])}function jr(r,e){return r[3]=e,r}const Cr=[0,0,1,0],R=Q(),rr=Q();v();var q;let g=q=class extends ur{constructor(r){super(r),this.origin=M(),this.translation=M(),this.rotation=v(),this.scale=fr(1,1,1),this.geographic=!0}get localMatrix(){const r=T();return G(r,r,this.scale),pr(r,r,Y(this.rotation),F(this.rotation)),yr(r,r,this.translation),r}get localMatrixInverse(){return U(T(),this.localMatrix)}applyLocal(r,e){return W(e,r,this.localMatrix)}applyLocalInverse(r,e){return W(e,r,this.localMatrixInverse)}project(r,e){const t=new Float64Array(r.length),a=p.fromTypedArray(t),n=p.fromTypedArray(r);if(this.geographic){const l=gr(mr(e)),c=T();return w(e,this.origin,c,l),hr(c,c,this.localMatrix),E(a,n,c),C(t,l,0,t,e,0,t.length/3),t}const{localMatrix:o,origin:i}=this;Ar(o,Lr)?_r(a,n):E(a,n,o);for(let l=0;l<t.length;l+=3)t[l+0]+=i[0],t[l+1]+=i[1],t[l+2]+=i[2];return t}getOriginPoint(r){const[e,t,a]=this.origin;return new Tr({x:e,y:t,z:a,spatialReference:r})}equals(r){return z(r)&&this.geographic===r.geographic&&$r(this.origin,r.origin)&&dr(this.localMatrix,r.localMatrix)}clone(){const r={origin:S(this.origin),translation:S(this.translation),rotation:v(this.rotation),scale:S(this.scale),geographic:this.geographic};return new q(r)}};h([A({type:[Number],nonNullable:!0,json:{write:!0}})],g.prototype,"origin",void 0),h([A({type:[Number],nonNullable:!0,json:{write:!0}})],g.prototype,"translation",void 0),h([A({type:[Number],nonNullable:!0,json:{write:!0}})],g.prototype,"rotation",void 0),h([A({type:[Number],nonNullable:!0,json:{write:!0}})],g.prototype,"scale",void 0),h([A({type:Boolean,nonNullable:!0,json:{write:!0}})],g.prototype,"geographic",void 0),h([A()],g.prototype,"localMatrix",null),h([A()],g.prototype,"localMatrixInverse",null),g=q=h([cr("esri.geometry.support.MeshTransform")],g);const zr=g;function b(r,e){var t;return r.isGeographic||r.isWebMercator&&((t=e==null?void 0:e.geographic)==null||t)}const N=Er.getLogger("esri.geometry.support.meshUtils.normalProjection");function Sr(r,e,t,a,n){return L(a)?(B(0,f.fromTypedArray(r),p.fromTypedArray(e),p.fromTypedArray(t),a,f.fromTypedArray(n)),n):(N.error("Cannot convert spatial reference to PCPF"),n)}function Yr(r,e,t,a,n){return L(a)?(B(1,f.fromTypedArray(r),p.fromTypedArray(e),p.fromTypedArray(t),a,f.fromTypedArray(n)),n):(N.error("Cannot convert to spatial reference from PCPF"),n)}function qr(r,e,t){return C(r,e,0,t,x(e),0,r.length/3),t}function Ir(r,e,t){return C(r,x(t),0,e,t,0,r.length/3),e}function Vr(r,e,t){if(y(r))return e;const a=p.fromTypedArray(r),n=p.fromTypedArray(e);return E(n,a,t),e}function Or(r,e,t){if(y(r))return e;P(u,t);const a=f.fromTypedArray(r),n=f.fromTypedArray(e);return $(n,a,u),J(u)||Z(n,n),e}function Gr(r,e,t){if(y(r))return e;P(u,t);const a=f.fromTypedArray(r,4*Float32Array.BYTES_PER_ELEMENT),n=f.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT);if($(n,a,u),J(u)||Z(n,n),r!==e)for(let o=3;o<r.length;o+=4)e[o]=r[o];return e}function Ur(r,e,t,a,n){if(!L(a))return N.error("Cannot convert spatial reference to PCPF"),n;B(0,f.fromTypedArray(r,4*Float32Array.BYTES_PER_ELEMENT),p.fromTypedArray(e),p.fromTypedArray(t),a,f.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT));for(let o=3;o<r.length;o+=4)n[o]=r[o];return n}function Wr(r,e,t,a,n){if(!L(a))return N.error("Cannot convert to spatial reference from PCPF"),n;B(1,f.fromTypedArray(r,16),p.fromTypedArray(e),p.fromTypedArray(t),a,f.fromTypedArray(n,16));for(let o=3;o<r.length;o+=4)n[o]=r[o];return n}function B(r,e,t,a,n,o){if(!e)return;const i=t.count,l=x(n);if(er(n))for(let c=0;c<i;c++)a.getVec(c,_),e.getVec(c,m),w(l,_,j,l),k(u,j),r===1&&D(u,u),H(m,m,u),o.setVec(c,m);else for(let c=0;c<i;c++){a.getVec(c,_),e.getVec(c,m),w(l,_,j,l),k(u,j);const d=wr(t.get(c,1));let s=Math.cos(d);r===0&&(s=1/s),u[0]*=s,u[1]*=s,u[2]*=s,u[3]*=s,u[4]*=s,u[5]*=s,r===1&&D(u,u),H(m,m,u),xr(m,m),o.setVec(c,m)}return o}function L(r){return er(r)||kr(r)}function er(r){return r.isWGS84||vr(r)||Fr(r)||Mr(r)}function kr(r){return r.isWebMercator}const _=M(),m=M(),j=T(),u=X();function tr(r,e,t){return b(e.spatialReference,t)?Kr(r,e,t):Jr(r,e,t)}function Dr(r,e,t){const{position:a,normal:n,tangent:o}=r;if(y(e))return{position:a,normal:n,tangent:o};const i=e.localMatrix;return tr({position:Vr(a,new Float64Array(a.length),i),normal:z(n)?Or(n,new Float32Array(n.length),i):null,tangent:z(o)?Gr(o,new Float32Array(o.length),i):null},e.getOriginPoint(t),{geographic:e.geographic})}function fe(r,e,t){if(t!=null&&t.useTransform){var a;const{position:n,normal:o,tangent:i}=r;return{vertexAttributes:{position:n,normal:o,tangent:i},transform:new zr({origin:[e.x,e.y,(a=e.z)!=null?a:0],geographic:b(e.spatialReference,t)})}}return{vertexAttributes:tr(r,e,t),transform:null}}function Hr(r,e,t){return b(e.spatialReference,t)?nr(r,e,t):I(r,e,t)}function pe(r,e,t,a){if(y(e))return Hr(r,t,a);const n=Dr(r,e,t.spatialReference);return t.equals(e.getOriginPoint(t.spatialReference))?I(n,t,a):b(t.spatialReference,a)?nr(n,t,a):I(n,t,a)}function Jr(r,e,t){const a=new Float64Array(r.position.length),n=r.position,o=e.x,i=e.y,l=e.z||0,{horizontal:c,vertical:d}=V(t?t.unit:null,e.spatialReference);for(let s=0;s<n.length;s+=3)a[s+0]=n[s+0]*c+o,a[s+1]=n[s+1]*c+i,a[s+2]=n[s+2]*d+l;return{position:a,normal:r.normal,tangent:r.tangent}}function Kr(r,e,t){const a=e.spatialReference,n=ar(e,t,O),o=new Float64Array(r.position.length),i=Qr(r.position,n,a,o),l=P(or,n);return{position:i,normal:Xr(i,o,r.normal,l,a),tangent:Zr(i,o,r.tangent,l,a)}}function Qr(r,e,t,a){E(p.fromTypedArray(a),p.fromTypedArray(r),e);const n=new Float64Array(r.length);return Ir(a,n,t)}function Xr(r,e,t,a,n){if(y(t))return null;const o=new Float32Array(t.length);return $(f.fromTypedArray(o),f.fromTypedArray(t),a),Yr(o,r,e,n,o),o}function Zr(r,e,t,a,n){if(y(t))return null;const o=new Float32Array(t.length);$(f.fromTypedArray(o,4*Float32Array.BYTES_PER_ELEMENT),f.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),a);for(let i=3;i<o.length;i+=4)o[i]=t[i];return Wr(o,r,e,n,o),o}function I(r,e,t){const a=new Float64Array(r.position.length),n=r.position,o=e.x,i=e.y,l=e.z||0,{horizontal:c,vertical:d}=V(t?t.unit:null,e.spatialReference);for(let s=0;s<n.length;s+=3)a[s+0]=(n[s+0]-o)/c,a[s+1]=(n[s+1]-i)/c,a[s+2]=(n[s+2]-l)/d;return{position:a,normal:r.normal,tangent:r.tangent}}function nr(r,e,t){const a=e.spatialReference;ar(e,t,O);const n=U(ne,O),o=new Float64Array(r.position.length),i=re(r.position,a,n,o),l=P(or,n);return{position:i,normal:ee(r.normal,r.position,o,a,l),tangent:te(r.tangent,r.position,o,a,l)}}function ar(r,e,t){w(r.spatialReference,[r.x,r.y,r.z||0],t,x(r.spatialReference));const{horizontal:a,vertical:n}=V(e?e.unit:null,r.spatialReference);return G(t,t,[a,a,n]),t}function re(r,e,t,a){const n=qr(r,e,a),o=p.fromTypedArray(n),i=new Float64Array(n.length),l=p.fromTypedArray(i);return E(l,o,t),i}function ee(r,e,t,a,n){if(y(r))return null;const o=Sr(r,e,t,a,new Float32Array(r.length)),i=f.fromTypedArray(o);return $(i,i,n),o}function te(r,e,t,a,n){if(y(r))return null;const o=Ur(r,e,t,a,new Float32Array(r.length)),i=f.fromTypedArray(o,4*Float32Array.BYTES_PER_ELEMENT);return $(i,i,n),o}function V(r,e){if(y(r))return ae;const t=e.isGeographic?1:Pr(e),a=e.isGeographic?1:Rr(e),n=br(1,r,"meters");return{horizontal:n*t,vertical:n*a}}const O=T(),ne=T(),or=X(),ae={horizontal:1,vertical:1};export{Ur as B,Sr as F,Ir as M,zr as O,Wr as R,Dr as _,Yr as a,fe as b,v as c,Y as d,ce as e,pe as f,Hr as k,F as l,ue as q,b as r,qr as v,tr as x};
