var e=Object.defineProperty,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,a=(t,r,i)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[r]=i;import{m as o,v as n,w as s,r as p,x as l}from"./vendor.d0a39f0f.js";const h=o.getLogger("esri/views/webgl");const d=!!n("enable-feature:webgl-debug");function c(){return d}function _(){return d}function m(e){if(c()){const t=e.getError();if(t){const r=function(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}(e,t),i=(new Error).stack;h.error(new s("webgl-error","WebGL error occured",{message:r,stack:i}))}}}const u=33984;var g,T;(T=g||(g={}))[T.Texture=0]="Texture",T[T.Buffer=1]="Buffer",T[T.VAO=2]="VAO",T[T.Program=3]="Program",T[T.Framebuffer=4]="Framebuffer",T[T.Renderbuffer=5]="Renderbuffer",T[T.COUNT=6]="COUNT";const M=33306;function f(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}class x{constructor(e,o,n=null){this._context=e,this.type="texture",this._glName=null,this._descriptor=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,e.instanceCounter.increment(g.Texture,this),this._descriptor=((e,o)=>{for(var n in o||(o={}))r.call(o,n)&&a(e,n,o[n]);if(t)for(var n of t(o))i.call(o,n)&&a(e,n,o[n]);return e})({target:3553,samplingMode:9729,wrapMode:10497,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1},o),34067===this._descriptor.target?this.setDataCubeMap(n):this.setData(n)}get glName(){return this._glName}get descriptor(){return this._descriptor}dispose(){this._context.gl&&this._glName&&(this._context.unbindTextureAllUnits(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(g.Texture,this))}release(){this.dispose()}resize(e,t){const r=this._descriptor;r.width===e&&r.height===t||(r.width=e,r.height=t,34067===this._descriptor.target?this.setDataCubeMap(null):this.setData(null))}setDataCubeMap(e=null){for(let t=34069;t<=34074;t++)this.setData(e,t)}setData(e,t=3553){if(!this._context||!this._context.gl)return;const r=this._context.gl;this._glName||(this._glName=r.createTexture()),void 0===e&&(e=null),null===e&&(this._descriptor.width=this._descriptor.width||4,this._descriptor.height=this._descriptor.height||4);const i=this._context.bindTexture(this,x.TEXTURE_UNIT_FOR_UPDATES),a=this._descriptor;x._validateTexture(this._context,a),r.pixelStorei(r.UNPACK_ALIGNMENT,a.unpackAlignment),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,a.flipped?1:0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.preMultiplyAlpha?1:0);const o=a.pixelFormat;let n=a.internalFormat?a.internalFormat:this._deriveInternalFormat(o,a.dataType);if(e instanceof ImageData||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement){let i=e.width,s=e.height;e instanceof HTMLVideoElement&&(i=e.videoWidth,s=e.videoHeight),a.width&&a.height,r.texImage2D(t,0,n,o,a.dataType,e),m(r),a.hasMipmap&&this.generateMipmap(),void 0===a.width&&(a.width=i),void 0===a.height&&(a.height=s)}else{null!=a.width&&null!=a.height||console.error("Width and height must be specified!"),r.DEPTH24_STENCIL8&&n===r.DEPTH_STENCIL&&(n=r.DEPTH24_STENCIL8);let i=a.width,s=a.height;if(function(e){return p(e)&&"type"in e&&"compressed"===e.type}(e)){const o=Math.round(Math.log(Math.max(i,s))/Math.LN2)+1;a.hasMipmap=a.hasMipmap&&o===e.levels.length;for(let p=0;;++p){const o=e.levels[Math.min(p,e.levels.length-1)];if(r.compressedTexImage2D(t,p,n,i,s,0,o),1===i&&1===s||!a.hasMipmap)break;i=Math.max(1,i>>1),s=Math.max(1,s>>1)}}else if(p(e))r.texImage2D(t,0,n,i,s,0,o,a.dataType,e),m(r),a.hasMipmap&&this.generateMipmap();else for(let e=0;r.texImage2D(t,e,n,i,s,0,o,a.dataType,null),m(r),(1!==i||1!==s)&&a.hasMipmap;++e)i=Math.max(1,i>>1),s=Math.max(1,s>>1)}x._applySamplingMode(r,this._descriptor),x._applyWrapMode(r,this._descriptor),x._applyAnisotropicFilteringParameters(this._context,this._descriptor),m(r),this._context.bindTexture(i,x.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,t,r,i,a,o,n=3553){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const s=this._context.gl,p=this._descriptor,l=this._context.bindTexture(this,x.TEXTURE_UNIT_FOR_UPDATES);(t<0||r<0||i>p.width||a>p.height||t+i>p.width||r+a>p.height)&&console.error("An attempt to update out of bounds of the texture!"),s.pixelStorei(s.UNPACK_ALIGNMENT,p.unpackAlignment),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,p.flipped?1:0),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,p.preMultiplyAlpha?1:0),o instanceof ImageData||o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement?s.texSubImage2D(n,e,t,r,p.pixelFormat,p.dataType,o):s.texSubImage2D(n,e,t,r,i,a,p.pixelFormat,p.dataType,o),this._context.bindTexture(l,x.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;e.hasMipmap||(e.hasMipmap=!0,this._samplingModeDirty=!0,x._validateTexture(this._context,e)),9729===e.samplingMode?(this._samplingModeDirty=!0,e.samplingMode=9985):9728===e.samplingMode&&(this._samplingModeDirty=!0,e.samplingMode=9984);const t=this._context.bindTexture(this,x.TEXTURE_UNIT_FOR_UPDATES);this._context.gl.generateMipmap(e.target),this._context.bindTexture(t,x.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,x._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._context.gl,t=this._descriptor;this._samplingModeDirty&&(x._applySamplingMode(e,t),this._samplingModeDirty=!1),this._wrapModeDirty&&(x._applyWrapMode(e,t),this._wrapModeDirty=!1)}_deriveInternalFormat(e,t){if("webgl"===this._context.webglVersion)return e;if(5126===t)switch(e){case 6408:return 34836;case 6407:return 34837;default:throw new Error("Unable to derive format")}return e}static _validateTexture(e,t){(t.width<0||t.height<0)&&console.error("Negative dimension parameters are not allowed!");const r=l(t.width)&&l(t.height);f(e.gl)||r||("number"==typeof t.wrapMode?33071!==t.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):33071===t.wrapMode.s&&33071===t.wrapMode.t||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),t.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(e,t){let r=t.samplingMode,i=t.samplingMode;9985===r||9987===r?(r=9729,t.hasMipmap||(i=9729)):9984!==r&&9986!==r||(r=9728,t.hasMipmap||(i=9728)),e.texParameteri(t.target,e.TEXTURE_MAG_FILTER,r),e.texParameteri(t.target,e.TEXTURE_MIN_FILTER,i)}static _applyWrapMode(e,t){"number"==typeof t.wrapMode?(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode)):(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode.s),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode.t))}static _applyAnisotropicFilteringParameters(e,t){var r;const i=e.capabilities.textureFilterAnisotropic;i&&e.gl.texParameterf(t.target,i.TEXTURE_MAX_ANISOTROPY,null!=(r=t.maxAnisotropy)?r:1)}}x.TEXTURE_UNIT_FOR_UPDATES=0;export{_ as c,g as e,M as f,f as n,x as o,u as r,m as s,c as u};
