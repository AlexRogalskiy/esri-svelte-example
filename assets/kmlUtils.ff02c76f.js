import{L as e,gr as t,b8 as o,bf as r,dp as s,gs as n,J as a,cO as i,gf as f,ge as l,dL as u,dO as y,gt as p,dP as c}from"./vendor.d0a39f0f.js";const m={esriGeometryPoint:"points",esriGeometryPolyline:"polylines",esriGeometryPolygon:"polygons"};function d(e){const t=e.folders||[],o=t.slice(),s=new Map,n=new Map,a=new Map,i=new Map,f=new Map,l={esriGeometryPoint:n,esriGeometryPolyline:a,esriGeometryPolygon:i};(e.featureCollection&&e.featureCollection.layers||[]).forEach((e=>{const t=r(e);t.featureSet.features=[];const o=e.featureSet.geometryType;s.set(o,t);const f=e.layerDefinition.objectIdField;"esriGeometryPoint"===o?G(n,f,e.featureSet.features):"esriGeometryPolyline"===o?G(a,f,e.featureSet.features):"esriGeometryPolygon"===o&&G(i,f,e.featureSet.features)})),e.groundOverlays&&e.groundOverlays.forEach((e=>{f.set(e.id,e)})),t.forEach((t=>{t.networkLinkIds.forEach((r=>{const s=function(e,t,o){const r=function(e,t){let o;return t.some((t=>t.id===e&&(o=t,!0))),o}(e,o);return r&&(r.parentFolderId=t,r.networkLink=r),r}(r,t.id,e.networkLinks);s&&o.push(s)}))})),o.forEach((e=>{e.featureInfos&&(e.points=r(s.get("esriGeometryPoint")),e.polylines=r(s.get("esriGeometryPolyline")),e.polygons=r(s.get("esriGeometryPolygon")),e.mapImages=[],e.featureInfos.map((t=>{switch(t.type){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryPolygon":{const o=l[t.type].get(t.id);o&&e[m[t.type]].featureSet.features.push(o);break}case"GroundOverlay":{const o=f.get(t.id);o&&e.mapImages.push(o);break}}})),e.fullExtent=P([e]))}));const u=P(o);return{folders:t,sublayers:o,extent:u}}function g(t,o,r,i){const f=s&&s.findCredential(t);t=n(t,{token:f&&f.token});const l=a.kmlServiceUrl;return e(l,{query:{url:t,model:"simple",folders:"",refresh:0!==r||void 0,outSR:JSON.stringify(o)},responseType:"json",signal:i})}function S(e,t,o=null,r=[]){const s=[],n={},a=t.sublayers,i=t.folders.map((e=>e.id));return a.forEach((t=>{const a=new e;if(o?a.read(t,o):a.read(t),r.length&&i.indexOf(a.id)>-1&&(a.visible=-1!==r.indexOf(a.id)),n[t.id]=a,null!=t.parentFolderId&&-1!==t.parentFolderId){const e=n[t.parentFolderId];e.sublayers||(e.sublayers=[]),e.sublayers.unshift(a)}else s.unshift(a)})),s}function G(e,t,o){o.forEach((o=>{e.set(o.attributes[t],o)}))}async function h(e){const t=i.fromJSON(e.featureSet).features,o=e.layerDefinition,r=f(o.drawingInfo.renderer),s=l.fromJSON(e.popupInfo),n=[];for(const a of t){const e=await r.getSymbolAsync(a);a.symbol=e,a.popupTemplate=s,a.visible=!0,n.push(a)}return n}function P(e){const r=u(y),s=u(y);for(const t of e){if(t.polygons&&t.polygons.featureSet&&t.polygons.featureSet.features)for(const e of t.polygons.featureSet.features)p(r,e.geometry),c(s,r);if(t.polylines&&t.polylines.featureSet&&t.polylines.featureSet.features)for(const e of t.polylines.featureSet.features)p(r,e.geometry),c(s,r);if(t.points&&t.points.featureSet&&t.points.featureSet.features)for(const e of t.points.featureSet.features)p(r,e.geometry),c(s,r);if(t.mapImages)for(const e of t.mapImages)p(r,e.extent),c(s,r)}return t(s,y)?null:{xmin:s[0],ymin:s[1],zmin:s[2],xmax:s[3],ymax:s[4],zmax:s[5],spatialReference:o.WGS84}}export{S,h as b,d,g,P as j};
