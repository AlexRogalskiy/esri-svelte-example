var Ae=Object.defineProperty,Ie=Object.defineProperties;var be=Object.getOwnPropertyDescriptors;var ee=Object.getOwnPropertySymbols;var xe=Object.prototype.hasOwnProperty,Le=Object.prototype.propertyIsEnumerable;var te=(e,t,n)=>t in e?Ae(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ne=(e,t)=>{for(var n in t||(t={}))xe.call(t,n)&&te(e,n,t[n]);if(ee)for(var n of ee(t))Le.call(t,n)&&te(e,n,t[n]);return e},oe=(e,t)=>Ie(e,be(t));import{n as Ve}from"./deduplicate.5a4ef868.js";import{y as Ne,u as Se,i as Ee,c as Fe,l as Ue,p as Be,o as De,m as We,T as Me,h as ke,a as ze,b as je,d as He,A as Pe,O as Oe,x as Te,g as Ce,w as qe,E as Ge,L as Je,B as Re,F as _e,I as Ke,U as Qe,j as Xe,V as Ye,M as Ze,S as et,k as tt,q as nt,v as ot,z as rt,C as st,D as it,G as at,H as ct}from"./BufferView.49ab0c27.js";import{e7 as ft,e8 as re,ae as b,cg as lt,e9 as se,ea as ut,eb as gt,af as H,ec as ie,ed as P,ee as ae,ef as dt,eg as pt,eh as ce,ei as mt}from"./vendor.f5642644.js";import{A as O}from"./InterleavedLayout.39198eb3.js";import"./types.9ca5134f.js";function fe(e,t,n){const s=t/3,r=new Uint32Array(n+1),a=new Uint32Array(n+1),d=(o,i)=>{o<i?r[o+1]++:a[i+1]++};for(let o=0;o<s;o++){const i=e[3*o],u=e[3*o+1],g=e[3*o+2];d(i,u),d(u,g),d(g,i)}let c=0,p=0;for(let o=0;o<n;o++){const i=r[o+1],u=a[o+1];r[o+1]=c,a[o+1]=p,c+=i,p+=u}const f=new Uint32Array(6*s),l=r[n],h=(o,i,u)=>{if(o<i){const g=r[o+1]++;f[2*g]=i,f[2*g+1]=u}else{const g=a[i+1]++;f[2*l+2*g]=o,f[2*l+2*g+1]=u}};for(let o=0;o<s;o++){const i=e[3*o],u=e[3*o+1],g=e[3*o+2];h(i,u,o),h(u,g,o),h(g,i,o)}const w=(o,i)=>{const u=2*o,g=i-o;for(let y=1;y<g;y++){const I=f[u+2*y],V=f[u+2*y+1];let v=y-1;for(;v>=0&&f[u+2*v]>I;v--)f[u+2*v+2]=f[u+2*v],f[u+2*v+3]=f[u+2*v+1];f[u+2*v+2]=I,f[u+2*v+3]=V}};for(let o=0;o<n;o++)w(r[o],r[o+1]),w(l+a[o],l+a[o+1]);const m=new Int32Array(3*s),x=(o,i)=>o===e[3*i]?0:o===e[3*i+1]?1:o===e[3*i+2]?2:-1,$=(o,i)=>{const u=x(o,i);m[3*i+u]=-1},L=(o,i,u,g)=>{const y=x(o,i);m[3*i+y]=g;const I=x(u,g);m[3*g+I]=i};for(let o=0;o<n;o++){let i=r[o];const u=r[o+1];let g=a[o];const y=a[o+1];for(;i<u&&g<y;){const I=f[2*i],V=f[2*l+2*g];I===V?(L(o,f[2*i+1],V,f[2*l+2*g+1]),i++,g++):I<V?($(o,f[2*i+1]),i++):($(V,f[2*l+2*g+1]),g++)}for(;i<u;)$(o,f[2*i+1]),i++;for(;g<y;)$(f[2*l+2*g],f[2*l+2*g+1]),g++}return m}function le(e,t){return t.push(e.buffer),{buffer:e.buffer,layout:ht(e.layout)}}function ht(e){const t=new Array;return e.fields.forEach((n,s)=>{const r=oe(ne({},n),{constructor:ue(n.constructor)});t.push([s,r])}),{stride:e.stride,fields:t,fieldNames:e.fieldNames}}const wt=[Ne,Se,Ee,Fe,Ue,Be,De,We,Me,ke,ze,je,He,Pe,Oe,Te,Ce,qe,Ge,Je,Re,_e,Ke,Qe,Xe,Ye,Ze,et,tt,nt,ot,rt,st,it,at,ct];function ue(e){return`${e.ElementType}_${e.ElementCount}`}const $t=new Map;wt.forEach(e=>$t.set(ue(e),e));function T(e,t=0){const n=e.stride;return e.fieldNames.filter(s=>{const r=e.fields.get(s).optional;return!(r&&r.glPadding)}).map(s=>{const r=e.fields.get(s),a=r.constructor.ElementCount,d=yt(r.constructor.ElementType),c=r.offset,p=!(!r.optional||!r.optional.glNormalized);return{name:s,stride:n,count:a,type:d,offset:c,normalized:p,divisor:t}})}function yt(e){const t=vt[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const vt={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126},ge=O().vec3f("position").u16("componentIndex").u16("u16padding"),At=O().vec2u8("sideness");T(At);const de=O().vec3f("position0").vec3f("position1").u16("componentIndex").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).u8("u8padding",{glPadding:!0}).u16("u16padding",{glPadding:!0}),C=de.clone().vec3f("normal"),q=de.clone().vec3f("normalA").vec3f("normalB");class pe{updateSettings(t){this.settings=t,this.edgeHashFunction=t.reducedPrecision?bt:It}write(t,n,s){const r=this.edgeHashFunction(s);z.seed=r;const a=z.getIntRange(0,255),d=z.getIntRange(0,this.settings.variants-1),c=.7,p=z.getFloat(),f=255*(.5*xt(-(1-Math.min(p/c,1))+Math.max(0,p-c)/(1-c),1.2)+.5);t.position0.setVec(n,s.position0),t.position1.setVec(n,s.position1),t.componentIndex.set(n,s.componentIndex),t.variantOffset.set(n,a),t.variantStroke.set(n,d),t.variantExtension.set(n,f)}trim(t,n){return t.slice(0,n)}}const G=new Float32Array(6),M=new Uint32Array(G.buffer),N=new Uint32Array(1);function It(e){const t=G;t[0]=e.position0[0],t[1]=e.position0[1],t[2]=e.position0[2],t[3]=e.position1[0],t[4]=e.position1[1],t[5]=e.position1[2],N[0]=5381;for(let n=0;n<M.length;n++)N[0]=31*N[0]+M[n];return N[0]}function bt(e){const t=G;t[0]=U(e.position0[0]),t[1]=U(e.position0[1]),t[2]=U(e.position0[2]),t[3]=U(e.position1[0]),t[4]=U(e.position1[1]),t[5]=U(e.position1[2]),N[0]=5381;for(let n=0;n<M.length;n++)N[0]=31*N[0]+M[n];return N[0]}const me=1e4;function U(e){return Math.round(e*me)/me}function xt(e,t){const n=e<0?-1:1;return Math.abs(e)**t*n}class J{constructor(){this.commonWriter=new pe}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return C.createBuffer(t)}write(t,n,s){this.commonWriter.write(t,n,s),ft(k,s.faceNormal0,s.faceNormal1),re(k,k),t.normal.setVec(n,k)}trim(t,n){return this.commonWriter.trim(t,n)}}J.Layout=C,J.glLayout=T(C,1);class R{constructor(){this.commonWriter=new pe}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return q.createBuffer(t)}write(t,n,s){this.commonWriter.write(t,n,s),t.normalA.setVec(n,s.faceNormal0),t.normalB.setVec(n,s.faceNormal1)}trim(t,n){return this.commonWriter.trim(t,n)}}R.Layout=q,R.glLayout=T(q,1);const k=b(),z=new lt,S=-1;function Lt(e,t,n,s=Ut){const r=e.vertices.position,a=e.vertices.componentIndex,d=se(s.anglePlanar),c=se(s.angleSignificantEdge),p=Math.cos(c),f=Math.cos(d),l=_.edge,h=l.position0,w=l.position1,m=l.faceNormal0,x=l.faceNormal1,$=Ft(e),L=Et(e),o=L.length/4,i=t.allocate(o);let u=0;const g=o,y=n.allocate(g);let I=0,V=0,v=0;const Q=ut(0,o),D=new Float32Array(o);gt(D,(E,A,B)=>{r.getVec(L[4*A+0],h),r.getVec(L[4*A+1],w),B[A]=mt(h,w)}),Q.sort((E,A)=>D[A]-D[E]);const X=new Array,Y=new Array;for(let E=0;E<o;E++){const A=Q[E],B=D[A],j=L[4*A+0],ve=L[4*A+1],F=L[4*A+2],W=L[4*A+3],Z=W===S;if(r.getVec(j,h),r.getVec(ve,w),Z)H(m,$[3*F+0],$[3*F+1],$[3*F+2]),ie(x,m),l.componentIndex=a.get(j),l.cosAngle=P(m,x);else{if(H(m,$[3*F+0],$[3*F+1],$[3*F+2]),H(x,$[3*W+0],$[3*W+1],$[3*W+2]),l.componentIndex=a.get(j),l.cosAngle=P(m,x),Nt(l,f))continue;l.cosAngle<-.9999&&ie(x,m)}V+=B,v++,Z||Vt(l,p)?(t.write(i,u++,l),X.push(B)):St(l,d)&&(n.write(y,I++,l),Y.push(B))}const $e=new Float32Array(X.reverse()),ye=new Float32Array(Y.reverse());return{regular:{instancesData:t.trim(i,u),lodInfo:{lengths:$e}},silhouette:{instancesData:n.trim(y,I),lodInfo:{lengths:ye}},averageEdgeLength:V/v}}function Vt(e,t){return e.cosAngle<t}function Nt(e,t){return e.cosAngle>t}function St(e,t){const n=dt(e.cosAngle),s=_.fwd,r=_.ortho;return pt(s,e.position1,e.position0),n*(P(ae(r,e.faceNormal0,e.faceNormal1),s)>0?-1:1)>t}function Et(e){const t=e.faces.length/3,n=e.faces,s=e.neighbors;let r=0;for(let c=0;c<t;c++){const p=s[3*c+0],f=s[3*c+1],l=s[3*c+2],h=n[3*c+0],w=n[3*c+1],m=n[3*c+2];r+=p===S||h<w?1:0,r+=f===S||w<m?1:0,r+=l===S||m<h?1:0}const a=new Int32Array(4*r);let d=0;for(let c=0;c<t;c++){const p=s[3*c+0],f=s[3*c+1],l=s[3*c+2],h=n[3*c+0],w=n[3*c+1],m=n[3*c+2];(p===S||h<w)&&(a[d++]=h,a[d++]=w,a[d++]=c,a[d++]=p),(f===S||w<m)&&(a[d++]=w,a[d++]=m,a[d++]=c,a[d++]=f),(l===S||m<h)&&(a[d++]=m,a[d++]=h,a[d++]=c,a[d++]=l)}return a}function Ft(e){const t=e.faces.length/3,n=e.vertices.position,s=e.faces,r=K.v0,a=K.v1,d=K.v2,c=new Float32Array(3*t);for(let p=0;p<t;p++){const f=s[3*p+0],l=s[3*p+1],h=s[3*p+2];n.getVec(f,r),n.getVec(l,a),n.getVec(h,d),ce(a,a,r),ce(d,d,r),ae(r,a,d),re(r,r),c[3*p+0]=r[0],c[3*p+1]=r[1],c[3*p+2]=r[2]}return c}const _={edge:{position0:b(),position1:b(),faceNormal0:b(),faceNormal1:b(),componentIndex:0,cosAngle:0},ortho:b(),fwd:b()},K={v0:b(),v1:b(),v2:b()},Ut={anglePlanar:4,angleSignificantEdge:35};async function Tt(e){const t=Dt(e),n=Bt(t),s=[t.data.buffer];return{result:Wt(n,s),transferList:s}}function Bt(e){const t=Mt(e.data,e.skipDeduplicate,e.indices,e.indicesLength);return he.updateSettings(e.writerSettings),we.updateSettings(e.writerSettings),Lt(t,he,we)}function Dt(e){return{data:ge.createView(e.dataBuffer),indices:e.indicesType==="Uint32Array"?new Uint32Array(e.indicesBuffer):e.indicesType==="Uint16Array"?new Uint16Array(e.indicesBuffer):void 0,indicesLength:e.indicesLength,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate}}function Wt(e,t){return t.push(e.regular.lodInfo.lengths.buffer),t.push(e.silhouette.lodInfo.lengths.buffer),{regular:{instancesData:le(e.regular.instancesData,t),lodInfo:{lengths:e.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:le(e.silhouette.instancesData,t),lodInfo:{lengths:e.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:e.averageEdgeLength}}function Mt(e,t,n,s){if(t)return{faces:n,facesLength:s,neighbors:fe(n,s,e.count),vertices:e};const r=Ve(e.buffer,e.stride/4,{originalIndices:n,originalIndicesLength:s}),a=fe(r.indices,s,r.uniqueCount);return{faces:r.indices,facesLength:r.indices.length,neighbors:a,vertices:ge.createView(r.buffer)}}const he=new J,we=new R;export{Bt as work,Tt as wrappedWork};
